# 📎 KTAS ? 말고 NTAS(팀명: NamNam)
![image](https://github.com/2024-SMHRD-KDT-BigData-23/EmergencyRoomDashboard/assets/155136709/b5da37de-60cb-4ba5-82e0-c1093569aaab)

## 👀 서비스 소개
* 서비스명: 응급실 생체신호 데이터를 활용한 AI기반 응급환자 스크리닝 시스템(NTAS)
* 서비스설명: 응급실에 내원한 환자의 생체 신호 데이터를 실시간 모니터링하여, 환자의 위험도를 정확하게 평가하고, 응급실 퇴실 후의 최적 배치 판단을 보조해주는 시스템을 통해 의료진의 주관적인 판단의 개입 가능성을 줄이고, 환자 관리의 용이성 제공
<br>


## 📅 프로젝트 기간
2024.05.23 ~ 2024.06.20 (4주)
<br>

## ⭐ 주요 기능
* 기능1 : 응급실의 응급 환자 데이터 업데이트 환경
* 기능2 : 응급실 환자 데이터(MIMIC-IV-ED)를 활용한 위험도 평가 인공지능 모델
* 기능3 : 의료진과 환자의 개인정보 보호와 생체 신호 데이터 보안 적용
* 기능4 : 응급 환자 스크리닝을 위한 환자 목록 조회 기능
* 기능5 : 환자가 속한 구역, 위험도 필터링 기능
* 기능6 : 환자의 응급실 입실 정보 검색 기능
* 기능7 : 환자의 바이탈 시간별 확인 차트
* 기능8 : 의료진이 환자의 배치를 결정할 수 있는 기능
* 기능9 : 의료진 계정 관리 기능
* 기능10 : 의료진의 환자 배치 결정 로그 확인 및 다운로드 기능
* 기능11 : 시스템 자원 식별 기능
* 기능12 : 시스템 오류 문의 기능
<br>

<details>
<summary><b>주요 기능 설명 펼치기</b></summary>
<div markdown="1">

* 기능1 : 반응형 웹![image](https://github.com/2024-SMHRD-KDT-BigData-23/FitNeeds/assets/155136709/97fa57ab-2eca-4958-9f1f-fe32d6919aba)
* 기능2 : 서비스 소개 페이지![image](https://github.com/2024-SMHRD-KDT-BigData-23/FitNeeds/assets/155136709/303d9ae0-d7c9-42e5-9e92-a3c5266d0466)
* 기능3 : 네이버 로그인 api![image](https://github.com/2024-SMHRD-KDT-BigData-23/FitNeeds/assets/155136709/0c279508-1241-4bcd-af27-2171720d8c2f)
* 기능4 : 사용자 ui/ux![image](https://github.com/2024-SMHRD-KDT-BigData-23/FitNeeds/assets/155136709/86b0cfa5-908d-4695-859a-7660039b5c3a)
* 기능5 : Chart.js를 활용한 다양한 차트 시각화![image](https://github.com/2024-SMHRD-KDT-BigData-23/FitNeeds/assets/155136709/ca4ae21d-8973-4e8c-b08e-84624b58d705)
![image](https://github.com/2024-SMHRD-KDT-BigData-23/FitNeeds/assets/155136709/6ae83fa0-41a3-422a-92e2-eb4b9f986fcd)
![image](https://github.com/2024-SMHRD-KDT-BigData-23/FitNeeds/assets/155136709/91733c07-bdd0-44cd-897f-053c975be8d9)
* 기능6 : 최신뉴스 및 블로그 크롤링![image](https://github.com/2024-SMHRD-KDT-BigData-23/FitNeeds/assets/155136709/d7a14b23-f542-4503-9c47-e54b6e6f6f13)
* 기능7 : 예약 서비스 및 Fullcalendar api![image](https://github.com/2024-SMHRD-KDT-BigData-23/FitNeeds/assets/155136709/8c11627a-59a1-4b5a-a424-50247fec82a3)

</div>
</details>

## ⛏ 기술스택
<table>
    <tr>
        <td>사용언어</td>
        <td>
            <img src="https://img.shields.io/badge/Spring%20Boot-6DB33F?style=for-the-badge&logo=Spring%20Boot&logoColor=white"/>
            <img src="https://img.shields.io/badge/HTML5-E34F26?style=for-the-badge&logo=HTML5&logoColor=white"/>
            <img src="https://img.shields.io/badge/CSS3-1572B6?style=for-the-badge&logo=CSS3&logoColor=white"/>
            <img src="https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=JavaScript&logoColor=white"/>
        </td>
    </tr>
    <tr>
        <td>라이브러리</td>
        <td>
            <img src="https://img.shields.io/badge/axios-5A29E4?style=for-the-badge&logo=axios&logoColor=white"/>
            <img src="https://img.shields.io/badge/BootStrap-7952B3?style=for-the-badge&logo=BootStrap&logoColor=white"/>
            <img src="https://img.shields.io/badge/Chart.js-F5788D?style=for-the-badge&logo=Chart.js&logoColor=white"/>
            <img src="https://img.shields.io/badge/JWT-000000?style=for-the-badge&logo=JSON%20web%20tokens&logoColor=white"/>
            <img src="https://img.shields.io/badge/Swagger-85EA2D?style=for-the-badge&logo=Swagger&logoColor=black"/>
            <img src="https://img.shields.io/badge/send%20email-4285F4?style=for-the-badge&logo=Gmail&logoColor=white"/>
            <img src="https://img.shields.io/badge/PDF-E34F26?style=for-the-badge&logo=Adobe%20Acrobat%20Reader&logoColor=white"/>
            <img src="https://img.shields.io/badge/DataFaker-FF8C00?style=for-the-badge&logo=datafaker&logoColor=white"/>
            <img src="https://img.shields.io/badge/Security-FF0000?style=for-the-badge&logo=Secure&logoColor=white"/>
            <img src="https://img.shields.io/badge/Lombok-FF4500?style=for-the-badge&logo=lombok&logoColor=white"/>
        </td>
    </tr>
    <tr>
        <td>개발도구</td>
        <td>
            <img src="https://img.shields.io/badge/IntelliJ-000000?style=for-the-badge&logo=IntelliJ%20IDEA&logoColor=white"/>
            <img src="https://img.shields.io/badge/VSCode-007ACC?style=for-the-badge&logo=VisualStudioCode&logoColor=white"/>
            <img src="https://img.shields.io/badge/Jupyter%20Notebook-F37626.svg?&style=for-the-badge&logo=Jupyter&logoColor=white"/>
            <img src="https://img.shields.io/badge/Gradle-02303A?style=for-the-badge&logo=Gradle&logoColor=white"/>
        </td>
    </tr>
    <tr>
        <td>서버환경</td>
        <td>
            <img src="https://img.shields.io/badge/Apache Tomcat-D22128?style=for-the-badge&logo=Apache Tomcat&logoColor=white"/>
            <img src="https://img.shields.io/badge/Flask-000000?style=for-the-badge&logo=Flask&logoColor=white"/> 
            <img src="https://img.shields.io/badge/Node.js-339933?style=for-the-badge&logo=Node.js&logoColor=white"/>
        </td>
    </tr>
    <tr>
        <td>데이터베이스</td>
        <td>
            <img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white">
        </td>
    </tr>
    <tr>
        <td>협업도구</td>
        <td>
            <img src="https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=Git&logoColor=white"/>
            <img src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white"/>
        </td>
    </tr>
    <tr>
        <td>DevOps 도구</td>
        <td>
            <img src="https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=Docker&logoColor=white"/>
            <img src="https://img.shields.io/badge/Docker%20Hub-2496ED?style=for-the-badge&logo=Docker&logoColor=white"/>
            <img src="https://img.shields.io/badge/AWS-232F3E?style=for-the-badge&logo=Amazon%20AWS&logoColor=white"/>
            <img src="https://img.shields.io/badge/Jenkins-D24939?style=for-the-badge&logo=Jenkins&logoColor=white"/>
        </td>
    </tr>
</table>



<br>

## ⚙ 시스템 아키텍처
![Read-me아키텍처](https://github.com/2024-SMHRD-KDT-BigData-23/EmergencyRoomDashboard/assets/155136709/5ac9c5c9-bba1-4369-b0c7-a909b6fb1790)

<br>



## 📌 ER다이어그램
![ER다이어그램](https://github.com/2024-SMHRD-KDT-BigData-23/EmergencyRoomDashboard/assets/155136709/61862d77-f664-46bc-a7e1-2ccc207db17a)

<br>



## 👨‍👩‍👦‍👦 팀원 역할
<table>
  <tr>
    <td align="center"><img src="https://i.namu.wiki/i/GirsrnQUH-q5qbVv871h4zLg_H1X25k25qY-Vr5DcO6xV8MWdcENwySAA0M62Xyurjt3ezZUbPm7GoVYJRRXWGIAXpWJ0_zsEH0mxNsLH2S_GX54w9exBaOg6io06JjbYZRHQiPSyUwPoLzRFA5aeQ.webp" width="100" height="100"/></td>
    <td align="center"><img src="https://mb.ntdtv.kr/assets/uploads/2019/01/Screen-Shot-2019-01-08-at-4.31.55-PM-e1546932545978.png" width="100" height="100"/></td>
    <td align="center"><img src="https://github.com/2024-SMHRD-KDT-BigData-23/FitNeeds/assets/155136709/60cfda0f-23f4-4e5d-a953-12565033b91b" height="100"/></td>
    <td align="center"><img src="https://i.pinimg.com/236x/ed/bb/53/edbb53d4f6dd710431c1140551404af9.jpg" width="100" height="100"/></td>
  
  <tr>
    <td align="center"><strong>정연재</strong></td>
    <td align="center"><strong>김동완</strong></td>
    <td align="center"><strong>이병헌</strong></td>
    <td align="center"><strong>이지훈</strong></td>
  </tr>
  <tr>
    <td align="center"><b>PM, Full-Stack, Data Modeling</b></td>
    <td align="center"><b>Front-end</b></td>
    <td align="center"><b>Back-end</b></td>
    <td align="center"><b>Full-Stack, Devops</b></td>
  </tr>
  <tr>
    <td align="center"><a href="https://github.com/YeonjaeMan" target='_blank'>github</a></td>
    <td align="center"><a href="https://github.com/wandongk" target='_blank'>github</a></td>
    <td align="center"><a href="https://github.com/LBH1226" target='_blank'>github</a></td>
    <td align="center"><a href="https://github.com/dlwlgnsrhy" target='_blank'>github</a></td>
  </tr>
  <tr>
    <td align="center"> <b>* 프로젝트&산출문서관리&발표 <br><br> * EMR과 유사한 더미데이터 생성 기능 <br><br> *환자 상세 정보 페이지 UI/UX <br><br> *환자의 배치 결정 & 상태 기록 기능 <br><br> *MIMIC 데이터 전처리 및 LightGBM 모델링<br><br> React Component Hook 관리<br><br> React useParams를 이용한 SPA 구현<br><br> React Promise 병렬 비동기 통신을 이용한 서버 데이터 불러오기</b>b> </td>
    <td align="center"> <b>화면 UI/UX 설계 & PPT 제작 Bootstrap을 사용해 전체 페이지 Design <br><br> login & Header & In-ER & Ex-ER & Search 화면 구성 <br><br> React axios 미동기 통신을 이용한 서버 데이터 불러오기 <br><br> React useState를 이용한 상태관리 <br><br> React useNavigate를 이용한 페이지 간 이동</b></td>
    <td align="center"> <b>데이터베이스 요구 사항 분석 & 테이블 설계 & 시연 영상 제작 <br><br> VIEW와 Spring Data JPA를 사용한 환자 기본 정보 & 상세 정보 조회 기능 & 환자 입원 구역과 NTAS 위험도 필터링 기능 & 환자 검색 기능<br><br>Role UI/UX 및 사용자 계정 추가, 수정, 권한 관련 기능<br><br>Log 목록 조회, 검색 기능</b></td>
    <td align="center"><b> 아키텍처 설계 <br><br> React 및 Spring Boot 개발 환경 구축 <br><br> JWT를 이용한 로그인 & 로그아웃 & 사용자 권한 관리 <br><br> 환자 목록 페이징 <br><br> 더미 데이터에 AI모델을 추가하는 Flask 서버 구축 <br><br> Admin 설계 및 UI/UX 최적화 <br><br> 시스템 자원 사용률 & DB 백업 기능 <br><br> Docker & Jenkis & AWS를 사용해서 자동 CI/CD 및 배포 환경 구축 </b></td>
  </tr>
</table>



## 🤾‍♂️ 트러블슈팅


<details>
<summary>
### 🔨 차트의 오버랩 문제<br>
</summary>
- 문제<br>

  메인 페이지 접속시 오늘 날짜를 기준으로 7일전까지의 데이터를 가져와 시각화함.
  원하는 날짜로 바꾸어 차트의 값을 업데이트 할 경우 기존의 차트가 사라지지 않고 새로운 차트가 덧씌워지는 문제가 발생.

- 원인<br>

  new 연산자를 이용해 새로운 메모리로 할당됨에따라 canvas를 초기화하는게 아닌
  새로운 chart가 기존 차트에 덧씌우듯 표시되는 문제라 사료됨.
 
- 해결방안<br>

  update 메소드와 destroy 메소드 사용.
  update 메소드를 사용하였으나 console.log로 확인하였을때 값의 변경이 일어났지만 기존 차트는 유지됨.
  destory 메소드를 사용하여 기존의 차트 객체를 삭제하고 다시 설정해주는 방법으로 해결.
 
- 코드<br>
```
$("#date_check").on("click", function() {
		let start_date = $("#dateFrom").val();
		let end_date = $("#dateTo").val();
		
		// 기존 차트 데이터 삭제
		if(doughnutChart != undefined){
			doughnutChart.destroy();
		}
		if(lineChart != undefined){
			lineChart.destroy();
		}
		fetchStartExChart(start_date, end_date);
		fetchStartChChart(start_date, end_date);
	});
```
</details>

<details>
<summary>
### 🔨 비밀번호 암호화(SHA-256 + Salt)<br>
</summary>
- 문제<br>

  SHA-256은 단방향 알고리즘의 한 종류로, 해시 값을 이용한 암호화 방식.
  SHA-256을 사용하였을때 같은 비밀번호일 경우 같은 해시 값을 반환함을 확인.

- 원인<br>

  SHA-256은 입력 값에 해당하는 해시 값이 정해져 있음.
  레인보우 테이블을 이용해 해시 값을 통해 원본 문자열의 유추가 가능해짐.
  레인보우 테이블이란? => 해시 함수의 모든 입력값에 대한 결과값을 표로 정리한 것.
 
- 해결방안<br>

  무작위 숫자를 바이트 배열로 변환하여 이를 10진수 문자열로 변환한 Salt값을 추가로 생성.
  로그인 및 개인정보 수정 시 비밀번호의 확인을 위해 해당 Salt값을 알아야하기 때문에
  Member_id에 해당하는 Salt값을 저장하는 tb_salt 테이블을 생성 및 저장.
 
- 코드<br>
```
public class Encrypt {
	/**
	 * 무작위 문자열 Salt 생성
	 * 
	 * @return 생성된 Salt 문자열
	 */
	public static String getSalt() {
		// 1. SecureRandom 객체 생성
		SecureRandom sr = new SecureRandom();
		// 2. 무작위 바이트 배열 salt 생성 (길이: 20)
		byte[] salt = new byte[20];
		// 3. 무작위 바이트로 salt 배열 채우기
		sr.nextBytes(salt);
		// 4. 바이트 배열을 16진수 문자열로 변환하여 반환
		StringBuffer sb = new StringBuffer();
		for (byte b : salt) {
			sb.append(String.format("%02x", b));
		}
		return sb.toString();
	}
	/**
	 * 주어진 암호와 Salt를 이용하여 SHA-256 알고리즘을 적용한 결과를 반환
	 * 
	 * @param pwd  암호
	 * @param salt Salt 문자열
	 * @return 암호와 Salt를 이용하여 적용한 SHA-256 알고리즘 결과
	 */
	public static String getEncrypt(String pwd, String salt) {
		String result = "";
		try {
			// 1. SHA-256 알고리즘을 적용할 MessageDigest 객체 생성
			MessageDigest md = MessageDigest.getInstance("SHA-256");
			// 2. 암호와 Salt를 이용하여 MessageDigest 업데이트
			md.update((pwd + salt).getBytes());
			// 3. 업데이트된 내용으로 해시값 계산
			byte[] pwdSalt = md.digest();
			// 4. 해시값을 16진수 문자열로 변환하여 반환
			StringBuffer sb = new StringBuffer();
			for (byte b : pwdSalt) {
				sb.append(String.format("%02x", b));
			}
			result = sb.toString();
		} catch (NoSuchAlgorithmException e) {
			throw new RuntimeException(e);
		}
		return result;
	}
}
```
</details>

<details>
<summary>
### 🔨 비교차트 데이터의 undefined 값<br>
</summary>
- 문제<br>

  회원의 개인 데이터와 표준 데이터를 비교하기 위해 DB에 저장된 값을 ajax를 통해 불러오는 과정에서
  회원의 개인 데이터가 값을 가져오지만 undefined로 출력되는 문제가 발생.
  
- 원인<br>

  ajax를 통해서 가져온 회원의 개인 데이터가 success문 안에서만 값을 유지하기 때문에 발생하는 문제라 사료됨.
 
- 해결방안<br>

  처음 가져온 회원의 개인 데이터의 success안에서 표준 데이터를 가져오는 ajax문을 사용함으로써
  중첩ajax를 통해 회원의 개인 데이터와 표준 데이터의 값을 유지하면서 비교 차트를 화면에 시각화함. 
 
- 코드<br>
```
// 개인 및 표준 데이터 비교 차트 그리기
function fetchCompareChart() {
		// 개인 데이터 가져오기
		$.ajax({
			url: "MyData",
			type: 'POST',
			dataType: 'json',
			success: (res) => {
				mem_height = res.height;
				mem_weight = res.weight;
				mem_bmi = res.bmi;
				mem_muscle = res.muscle;
				mem_fat_per = res.fat_per;
				// success안에서만 값이 유지되기 때문에
				// 중첩 ajax를 이용하여 차트를 그림
				// 표준데이터 가져오기
				$.ajax({
					url: "StdData",
					type: 'POST',
					dataType: 'json',
					success: (res) => {
						std_height = res.height;
						std_weight = res.weight;
						std_bmi = res.bmi;
						std_muscle = res.muscle;
						std_fat_per = res.fat_per;
						// barChart와 radarChart 그리기
						drawCompareChart();
					},
					error: () => {
						console.log("실패");
					}
				});
			},
			error: () => {
			}
		});
	};
```
</details>

</details>

<details>
<summary>
### 🔨 VScode에서 Eclipse이동시 JS코드 적용오류<br>
</summary>
- 문제<br>

  VSCode에서 작업했던 내용들을 Eclipse로 이동시켜 jsp설정 후 로그인, 회원가입 부분 슬라이드 js가 작동안함.
  
- 원인<br>

  form태그로 전체 코드를 감싸 css와 js에 코드순서상 인식이 안되는것으로 파악 됨. 
 
- 해결방안<br>

  form태그로 전송할 코드 전체를 감싸지 않고, 코드 순서를 확인하여 js작동에 이상없는 부분에 적용함. 
 
- 기본코드<br>
```
	<form class="join-form" action="Join.do" method="post" onsubmit="showSuccessAlert()">
		<div class="carousel-item second" id="carousel-first">
			<img class="w-100" src="assets/images/join/carousel-bg.jpg"
				alt="Image">
			<div class="carousel-caption active">
				<div class="container">
					<div class="row justify-content-center">
						<div class="col-lg-7 pt-5">
							<h1 class="display-4 text-white mb-3 animated slideInDown">Sign
								up</h1>
							<p class="fs-5 text-white-50 mb-5 animated slideInDown">Fitneeds
								회원가입을 도와드릴게요 :)</p>
							<div>
								<div class="row g-3">
									<div class="col-12">
											<div class="form-floating">
												<input type="text" class="form-control bg-light border-0"
													id="mem_id" name="mem_id" placeholder="아이디를 입력해 주세요.">
												<label>아이디</label>
											</div>
									</div>

```

- 개선된 코드<br>
```
		<div class="carousel-item second" id="carousel-first">
			<img class="w-100" src="assets/images/join/carousel-bg.jpg"
				alt="Image">
			<div class="carousel-caption active">
				<div class="container">
					<div class="row justify-content-center">
						<div class="col-lg-7 pt-5">
							<h1 class="display-4 text-white mb-3 animated slideInDown">Sign up</h1>
							<p class="fs-5 text-white-50 mb-5 animated slideInDown">Fitneeds
								회원가입을 도와드릴게요 :)</p>
							<div>
								<div class="row g-3">
									<div class="col-12">
										<form class="join-form" action="Join.do" method="post" onsubmit="showSuccessAlert()">
											<div class="form-floating">
												<input type="text" class="form-control bg-light border-0"
													id="mem_id" name="mem_id" placeholder="아이디를 입력해 주세요.">
												<label>아이디</label>
											</div>
									</div>
									<div class="col-12">
										<div class="form-floating">
											<input type="text" class="form-control bg-light border-0"
												id="mem_pw" name="mem_pw" placeholder="Your Email">
											<label for="email">비밀번호</label>
										</div>
									</div>
```
</details>
## 🤾‍♂️ 라이선스 정보
